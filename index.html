<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="generator" content="Zettlr" />
  <meta name="date" content="" />
  <title></title>
  <style type="text/css">
  * {
    box-sizing: border-box;
  }

  a {
    color: #FF7C3B;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  hr {
    border: none;
    border-bottom: 1px solid #999;
    width: 80%;
  }

  html, body {
    margin: 0;
    padding: 0;
  }

  body {
    background-color: white;
    color: #333;
    font-family: 'DejaVu', 'Georgia', 'Times New Roman', 'Times', serif;
  }

  article {
    width: 50%;
    font-size: 1.5em;
    margin: 0 auto;
    line-height: 150%;
  }

  /* Better display on printing */
  @media print {
    article {
      width: 90%;
      font-size: 12pt;
      margin: 0 auto;
      line-height: 150%;
    }
  }

  article p {
    hyphens: auto;
    text-align: justify;
  }

  h1, h2, h3, h4, h5, h6 {
    font-family: 'Raleway', 'Lato', 'Liberation sans', 'Helvetica', sans-serif;
    color: #FF7C3B;
  }

  img {
    max-width: 100%;
    height: auto;
  }

  blockquote {
    font-size: 80%;
    color: rgba(120, 120, 120, 1);
    margin: 2% 5%;
    line-height: 120%;
  }

  table {
    border-collapse: collapse;
    width: 100%;
    font-size: 70%;
    font-family: 'Raleway', 'Lato', 'Liberation sans', 'Helvetica', sans-serif;
  }

  th, td {
    padding: 4px 20px;
    border-bottom: 1px solid #333;
  }

  figure {
    text-align: center;
  }

  figure figcaption {
    text-align: center;
  }

  /* List of classes taken from the skylighting lib */
  /* See: https://github.com/jgm/skylighting/blob/master/skylighting-core/src/Skylighting/Format/HTML.hs */

  /* Colors: Solarized theme (light) */
  /* See: https://ethanschoonover.com/solarized/ */

  /* Specific implementation: Taken from the GEdit theme (light) */
  /* See: https://github.com/altercation/solarized/blob/master/gedit/solarized-light.xml */

  /* Generic styles */
  pre.sourceCode {
    color: #657b83;
    background-color: #fdf6e3;
    box-shadow: 0px 0px 20px 0px rgba(0, 0, 0, .05);
    padding: 2px;
    overflow: auto;
  }

  /* All classes, taken from skylighting lib */
  .sourceCode .kw { color: #859900; font-weight: bold; } /* Keyword */
  .sourceCode .dt { color: #b58900; } /* Datatype */
  .sourceCode .df { color: #d33682; } /* Decimal values*/
  .sourceCode .bn { color: #d33682; } /* base-n-integers */
  .sourceCode .fl { color: #d33682; } /* Floats */
  .sourceCode .ch { color: #2aa198; } /* Character */
  .sourceCode .st { color: #2aa198; } /* String */
  .sourceCode .vs { color: #2aa198; } /* Verbatim String */
  .sourceCode .ss { color: #2aa198; } /* Special String */
  .sourceCode .co { color: #586e75; font-style: italic; } /* Comment */
  .sourceCode .ot { font-weight: bold; } /* Other token */
  .sourceCode .al { color: #d33682; background-color: #073642; } /* Alert */
  .sourceCode .fu { color: #268bd2; } /* Function name */
  .sourceCode .re {} /* Region marker */
  .sourceCode .er { color: #dc322f; font-weight: bold; } /* Error */
  .sourceCode .cn { color: #2aa198; } /* Constant */
  .sourceCode .sc { color: #dc322f; } /* Special character */
  .sourceCode .im { color: #6c71c4; font-weight: bold; } /* Import statement */
  .sourceCode .do { color: #dc322f; } /* Documentation string */
  .sourceCode .an { color: #2aa198; } /* Annotation */
  .sourceCode .cv { color: #6c71c4; } /* Comment var */
  .sourceCode .va { color: #268bd2; } /* Variable */
  .sourceCode .cf { color: #859900; } /* Control Flow (if, else, return) */
  .sourceCode .op {} /* Operator */
  .sourceCode .bu { color: #b58900; } /* Builtin function/class/identifier */
  .sourceCode .ex { color: #268bd2; } /* Extension */
  .sourceCode .pp { color: #cb4b16; } /* Preprocessor, like #import in C++ */
  .sourceCode .at { color: #dc322f; } /* Attribute */
  .sourceCode .in { color: #586e75; } /* Information */
  .sourceCode .wa { color: #cb4b16; } /* Warning */
  </style>

<!-- Pandoc variables -->

<!-- Additional CSS in case the user has passed it -->

<!-- Include MathJax CDN, if applicable -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body>
  <!-- Render in article for reader view enabling -->
    <article>
    <!-- Indentation must be zero for, e.g., PREs to work correctly -->
<h1 id="getting-started-with-comsol">Getting started with COMSOL</h1>
<h2 id="goals">Goals</h2>
<p>Introducing elementary COMSOL functions with Helmholtz coils. - Building object: drawing coils and domain - Setting the simulation - Solve and analyze the data</p>
<h2 id="remarks">Remarks</h2>
<ul>
<li>If you just want to play with COMSOL to get familiar, go to <code>File</code> → <code>Application Libraries</code> and check step-by-step documents.</li>
<li>If you are a person who need to read a book from the beginning, open COMSOL Documentation program that installed with COMSOL.</li>
<li>If you prefer a video guide, see <a href="https://www.youtube.com/watch?v=82L4eBYYGkU&amp;list=PLBk1I79rzfjlUrbINpMy-dBSb22l0jN5J">Youtube link</a> for kind tutorials provided by COMSOL.</li>
<li>Something written in <code>this format</code> is the words that you can find on your COMSOL window.</li>
</ul>
<h2 id="introduction">Introduction</h2>
<h3 id="helmholtz-coil">Helmholtz coil</h3>
<p>Picture of a commercial Helmholtz coils (picture from Bartington instrument).</p>
<figure>
<img src="imgs/a1230127dc26344dcbe2cb006402f481.png" alt="a1230127dc26344dcbe2cb006402f481.png" /><figcaption aria-hidden="true">a1230127dc26344dcbe2cb006402f481.png</figcaption>
</figure>
<p>In many laboratories, 3-pairs of Helmholtz coils are often used for canceling the Earth’s magnetic field. In physics laboratory, many experiments (such as atomic clocks or quantum computers) are magnetic field sensitive. It is also widely used in industries such as for calibrating the compass of the smartphone. COMSOL use Amphere’s law with the vector potential to calculate the magnetic field. <span class="math display">\[
\nabla \times \left( \mu^{-1} \nabla \times \boldsymbol{A} \right) = \boldsymbol{J}_{e}
\]</span> <span class="math inline">\(\boldsymbol{A}\)</span> is the vector potential, <span class="math inline">\(\boldsymbol{J}_e\)</span> is the current density we apply, and <span class="math inline">\(\mu\)</span> is the permeability of the material. Magnetic field is <span class="math inline">\(\boldsymbol{B} = \nabla\times\boldsymbol{A}\)</span>. We already learn how to calculate the axial magnetic field of a circular coil. We use Bio-Savart’s law to calculate the field, <span class="math display">\[
    d\boldsymbol{B} = \frac{\mu_0 I d\boldsymbol{l}\times\boldsymbol{r}}{4\pi r^3}
\]</span> The axial field, <span class="math inline">\(B_z\)</span> can be calculated using symmetry of the coil. <span class="math display">\[
B_z = \frac{\mu I}{2}\frac{R^2}{(R^2+z^2)^{3/2}}
\]</span> We can calculate the field from a pair of Helmholtz coil with some displacement in z direction. When the distance between the coils are the same as its radius, <span class="math inline">\(a\)</span>. The field at the center is <span class="math display">\[
B_z = \left(\frac{4}{5}\right)^{3/2} \frac{\mu_0NI}{a}
\]</span></p>
<p>Notice that this formula gives the field along the axis only and assumes infinitely thin wire. In addition, this formula is provided by an abstract or approximated situation. Using COMSOL we can calculate a bit realistic situation.</p>
<h3 id="workflow">Workflow</h3>
<p>(from a tutorial video) 1. Set up model environment 2. Create geometric object 3. Specify material properties 4. Define physics boundary conditions 5. Create the mesh 6. Run simulation 7. Post process the simulation</p>
<h2 id="simulating-helmholtz-coil">Simulating Helmholtz coil</h2>
<h3 id="set-up-model-environment">Set up model environment</h3>
<p>Create <code>new file</code>. Click <code>Model wizard</code>. Select <code>Geometry: 2D axisymmetric</code>. <code>AC/DC</code> → <code>Electromagnetic fields</code> →<code>Magnetic fields (mf)</code>. Since the system under our interest has cylindrical symmetry, we choose 2D axisymmetric rather than 3D. Using symmetry is useful in many cases. Press study. General studies → stationary. We see the following interface where we work mostly.</p>
<p><img src="imgs/f93d2ce1e8e5c9b39fcbb6002ffc701e.png" alt="f93d2ce1e8e5c9b39fcbb6002ffc701e.png" /> We see <code>Model Builder</code> pane and <code>Settings</code> pane and the other windows. <code>Model Builder</code> contains how we define the problem. The drop-down menus (<code>Global Definition</code>, <code>Compnent</code>, <code>Geometry</code>, .. ) are called node. Our simulation is consists of those nodes. <code>Settings</code> pane shows the properties of the selected node. If you right click on each node, you can find most of the actions you need to do. You can check and set values for the nodes in this pane. On the top, we have ribbon menu like MS Office, gives easy access to the nodes and its action on it.</p>
<h3 id="create-geometric-object">Create geometric object</h3>
<p>Let’s draw a pair of coil in <code>Geometry</code> node. r= 0 is the symmetry axis, we only draw two circles. Use <code>Geometry</code> ribbon on top of the menu or just right click <code>Geometry 1</code> in the <code>Model Builder</code>. We also need a rectangle as the domain of the magnetic field. You can draw more interactively with <code>Sketch</code> ribbon or type numbers in <code>Settings</code> pane.</p>
<figure>
<img src="imgs/6bc3519630f214b85f52673d06426732.png" alt="6bc3519630f214b85f52673d06426732.png" /><figcaption aria-hidden="true">6bc3519630f214b85f52673d06426732.png</figcaption>
</figure>
<h3 id="specify-material-properties">Specify material properties</h3>
<p>Now we define how those things are made of using <code>Materials</code>. Material defines a physical properties of the object. Right click on <code>Materials</code> and click <code>Add Material from library</code> and we see <code>Add Material</code> pane. Since we are going to simulate copper ring hanging in the air, we add air and copper. We search the material called <code>Air</code> and double click to add it to the simulation. Add <code>Copper</code> too. We designate which <code>Geometry</code> is made of selected material. We assign copper to two circles and air to the rectangle using <code>Geometric entity selection</code> menu in <code>Settings</code> pane.</p>
<figure>
<img src="imgs/32e91940e9b650fd8a901167fb80bd33.png" alt="32e91940e9b650fd8a901167fb80bd33.png" /><figcaption aria-hidden="true">32e91940e9b650fd8a901167fb80bd33.png</figcaption>
</figure>
<h3 id="define-physics-boundary-conditions">Define physics boundary conditions</h3>
<p>Now, we move on to the <code>Magnetic Fields (mf)</code> in the <code>Model Builder</code>. We are going to define the current flowing through the ring. Right click on the node and select <code>External Current Density</code>. select two circles and give 1 <span class="math inline">\(A/m^2\)</span> in <span class="math inline">\(\phi\)</span> direction.</p>
<figure>
<img src="imgs/e68316e80a3e884de10122026889080a.png" alt="e68316e80a3e884de10122026889080a.png" /><figcaption aria-hidden="true">e68316e80a3e884de10122026889080a.png</figcaption>
</figure>
<h3 id="create-the-mesh">Create the mesh</h3>
<p>Next, we set <code>Mesh</code> to solve the magnetic field. It is not possible to simulate the continuous domain, we slice the space into some small steps. There are rigorous mathematics behind this approximation, you can learn about this process in the future if you want. We select <code>Extra fine</code> element size and click <code>Build All</code> on top of the <code>Settings</code> pane.</p>
<figure>
<img src="imgs/f28c685972f004ec8da18b508c47033f.png" alt="f28c685972f004ec8da18b508c47033f.png" /><figcaption aria-hidden="true">f28c685972f004ec8da18b508c47033f.png</figcaption>
</figure>
<h3 id="run-simulation">Run simulation</h3>
<p>The set up is finished and let’s solve the equation. Go to <code>Study 1</code> node and click <code>Compute</code> in the <code>Settings</code>. You can see something is going on and get a nice plot on the <code>Graphics</code> window. COMSOL automatically plot something people might interest most, the magnitude of the magnetic field (or <code>Magnetic flux density norm</code>).</p>
<figure>
<img src="imgs/85dbb0d5adb5beef45b7ce6288127503.png" alt="85dbb0d5adb5beef45b7ce6288127503.png" /><figcaption aria-hidden="true">85dbb0d5adb5beef45b7ce6288127503.png</figcaption>
</figure>
<p>If you click <code>Magnetic Flux Density Norm, Revolved Geometry (mf)</code>, than you see what COMSOL actually solve. Since we selected axisymmetric 2D, we see cylindrically symmetric ring.</p>
<figure>
<img src="imgs/9e6ccf63c78633c1f18fa0e718cbf2c2.png" alt="9e6ccf63c78633c1f18fa0e718cbf2c2.png" /><figcaption aria-hidden="true">9e6ccf63c78633c1f18fa0e718cbf2c2.png</figcaption>
</figure>
<h3 id="post-process-the-simulation">Post process the simulation</h3>
<p>How to present and analyze data is as important as solving the problem. Let’s say we are interested in the direction of the magnetic field also. We right click on the <code>Magnetic Flux Denisrty Norm (mf)</code> node and add <code>Arrow Surface</code>. Click <code>Plot</code> than you get red arrows that shows the direction and the magnitude. You can play with adjusting the number of grid points and colors and scaling in <code>Settings</code> pane.</p>
<figure>
<img src="imgs/86c6b0fcf0f8154b5066f22ee28a05c3.png" alt="86c6b0fcf0f8154b5066f22ee28a05c3.png" /><figcaption aria-hidden="true">86c6b0fcf0f8154b5066f22ee28a05c3.png</figcaption>
</figure>
<p>The beauty of Helmholtz coil is the homogeneity of the field at the center with its simple geometry. We would like to check the uniformity using 1D cut plot along the axis. Right click on <code>Results</code> node and add <code>1D Plot Group</code>. Add <code>Line Graph</code> on <code>1D Plot Group</code>. Using this node, we can observe magnetic field strength along the symmetry axis. We set the selection in <code>Settings</code> pane to the axis, and check the data we want to plot <code>y-Axis Data</code> is the norm of the magnetic field (<code>mf.normB</code>). You can plot whatever you want by typing different <code>Expression</code> and you can find another expressions by expanding green and red arrow icon at the right corner.</p>
<figure>
<img src="imgs/86e17e53a78baa45ada6612a3163ace1.png" alt="86e17e53a78baa45ada6612a3163ace1.png" /><figcaption aria-hidden="true">86e17e53a78baa45ada6612a3163ace1.png</figcaption>
</figure>
<p>After we set, we click <code>Plot</code>, than we get the field value along the axis. You can compare this value with your analytic calculations you learn in General Physics course. Since we did not precisely set the geometry to Helmholtz condition, the field is not that homogeneous.</p>
<figure>
<img src="imgs/6706eb92bbb7a220ad25f81b1b663437.png" alt="6706eb92bbb7a220ad25f81b1b663437.png" /><figcaption aria-hidden="true">6706eb92bbb7a220ad25f81b1b663437.png</figcaption>
</figure>
<h3 id="getting-more-details">Getting more details</h3>
<p>To be more flexible in parameter tuning, we use <code>Parameters 1</code> in <code>Global Definitions</code> node. We would like to tune the radius of the ring, <span class="math inline">\(r_1\)</span> and the distance between two rings, <span class="math inline">\(d_1\)</span>. We can put <span class="math inline">\(r_1\)</span> and <span class="math inline">\(d_1\)</span> to different nodes to parametrize the simulation (the dimension should be the length in this case).</p>
<figure>
<img src="imgs/7fb3dafacfcd1f3399e82e76d2cab3ff.png" alt="7fb3dafacfcd1f3399e82e76d2cab3ff.png" /><figcaption aria-hidden="true">7fb3dafacfcd1f3399e82e76d2cab3ff.png</figcaption>
</figure>
<p>We put those to the location of the rings.</p>
<figure>
<img src="imgs/7ad6ecba820c92ad50290f1ae513af96.png" alt="7ad6ecba820c92ad50290f1ae513af96.png" /><figcaption aria-hidden="true">7ad6ecba820c92ad50290f1ae513af96.png</figcaption>
</figure>
<p>Update the geometry (<code>Build All Objects</code>), generate mesh again since you changed the geometry and compute the simulation again. You can observe more homogeneous field at the center.</p>
<figure>
<img src="imgs/9ee4474285489460f0cb2de7cce8bbdb.png" alt="9ee4474285489460f0cb2de7cce8bbdb.png" /><figcaption aria-hidden="true">9ee4474285489460f0cb2de7cce8bbdb.png</figcaption>
</figure>
<figure>
<img src="imgs/4b13d68e105b07e90039682e90abc75c.png" alt="4b13d68e105b07e90039682e90abc75c.png" /><figcaption aria-hidden="true">4b13d68e105b07e90039682e90abc75c.png</figcaption>
</figure>
<p>We can play with the parameters, <span class="math inline">\(r_1\)</span> and <span class="math inline">\(d_1\)</span>. We can test how the homogeneity changes by those parameters.</p>
<p>One can observe that the magnetic field is localized in the box we define (especially on the right edge of the box). This is because of the default boundary condition (magnetic insulation) set by the COMSOL. We basically simulate Helmholtz coil in a metal box made of high permeability (material that blocks the magnetic flux). We can extend the size of the box much larger than <span class="math inline">\(r_1\)</span> and <span class="math inline">\(d_1\)</span>, in order to minimize the effect of this artificial boundary. One can check whether the line graph converges or not by gradually extending the domain size.</p>
<figure>
<img src="imgs/3c6c26777756a87e967ca11068afa168.png" alt="3c6c26777756a87e967ca11068afa168.png" /><figcaption aria-hidden="true">3c6c26777756a87e967ca11068afa168.png</figcaption>
</figure>
<h2 id="homework">Homework</h2>
<ol type="1">
<li>Are we sure about this simulation? When we first try the simulation, we are not sure whether the simulation is right or not. In physics research field, people often call this kind of computer simulation as ‘experiment done in computer’. We need some process to test its reliability. One general method is comparing it with an analytic calculation. In this case we can compare the result with the formula from Bio-Savart’s law. Are they comparable? (Explain quantitatively)</li>
<li>Recognizing the mesh. What is the effect size of the wire? How thin can wire be? What happen if the wire is too small? (Explain qualitatively)</li>
<li>In the last part of the tutorial, we mentioned about high permeability material. How does the high permeability material block the field? Is there any real material like this? You may also learned about Faraday cage. How does it different from the Faraday cage? (Explain qualitatively)</li>
</ol>
  </article>
</body>
</html>
